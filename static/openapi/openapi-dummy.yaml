openapi: 3.0.3
info:
  title: API Documentation
  description: |
    Comprehensive REST API for building powerful applications.
    
    ## Authentication
    Most endpoints require authentication. Include your bearer token in the Authorization header:
    ```
    Authorization: Bearer YOUR_TOKEN
    ```
    
    ## Rate Limits
    API requests are rate-limited. Check the `X-RateLimit-*` headers in responses for current limits.
    
    ## Base URL
    All requests should be made to the base URL with the version prefix:
    ```
    https://api1.pepsales.xyz
  #   ```
  # version: "1.0.0"
  # contact:
  #   name: API Support
  #   email: support@example.com
  # license:
  #   name: MIT
  #   url: https://opensource.org/licenses/MIT

servers:
  - url: http://13.48.104.222:8000
    description: Production server
  - url: https://api1.pepsales.xyz
    description: Legacy server

tags:
  - name: Authentication
    description: User authentication and token management
  - name: Analyze Call
    description: Sales call analysis and insights

paths:
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate a user with email and password to receive an access token for API requests.
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
                password:
                  type: string
                  format: password
                  description: User's password
                  example: securepassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        description: JWT access token
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      refresh_token:
                        type: string
                        description: Refresh token for obtaining new access tokens
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      user:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
                          name:
                            type: string
                            example: John Doe
                          email:
                            type: string
                            format: email
                            example: user@example.com
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Too many login attempts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/meeting-insights:
    post:
      tags:
        - Analyze Call
      summary: Analyze sales call transcript
      description: |
        Analyze a sales call transcript to extract insights, call summary, follow-up email, sales framework metrics, key points, and questions.
        
        The analysis is performed synchronously and returns results immediately.
      operationId: analyzeCall
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - transcript
                - llm_provider
              properties:
                transcript:
                  type: array
                  description: Array of transcript entries
                  items:
                    type: object
                    required:
                      - speaker
                      - speaker_id
                      - text
                      - start_timestamp
                      - end_timestamp
                      - is_seller
                    properties:
                      speaker:
                        type: string
                        description: Speaker name
                        example: "Andy Waterhouse"
                      speaker_id:
                        type: integer
                        description: Speaker identifier
                        example: 50332672
                      text:
                        type: string
                        description: The spoken text content
                        example: "Each other. So we don't get to meet physically. I mean, we talk on a r…"
                      start_timestamp:
                        type: number
                        format: float
                        description: Start time in seconds
                        example: 0.18000000715255737
                      end_timestamp:
                        type: number
                        format: float
                        description: End time in seconds
                        example: 43.29999923706055
                      language:
                        type: string
                        nullable: true
                        description: Language code if available
                        example: null
                      is_seller:
                        type: boolean
                        description: Indicates if the speaker is the seller
                        example: false
                llm_provider:
                  type: string
                  description: LLM provider (e.g., "openai")
                  example: "openai"
            example:
              transcript:
                - end_timestamp: 43.29999923706055
                  language: null
                  speaker: "Andy Waterhouse"
                  speaker_id: 50332672
                  start_timestamp: 0.18000000715255737
                  text: "Each other. So we don't get to meet physically. I mean, we talk on a r…"
                  is_seller: false
                - end_timestamp: 52.91999816894531
                  language: null
                  speaker: "Ajay Singh"
                  speaker_id: 16778240
                  start_timestamp: 45.56999969482422
                  text: "We are planning to take a break in December, so we're going to Bali. F…"
                  is_seller: true
              llm_provider: "openai"
      responses:
        '200':
          description: Analysis successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      call_summary:
                        type: string
                        description: High-level summary of the call conversation
                        example: "Casual conversation with no business-related insights."
                      follow_up_email:
                        type: object
                        properties:
                          email:
                            type: string
                            description: Generated follow-up email content
                            example: "Hi Andy,\n\nThanks for the chat. No action items.\n\nRegards,\nAjay"
                      sales_framework:
                        type: object
                        properties:
                          total_score:
                            type: number
                            description: Total sales framework score
                            example: 0
                          parameters:
                            type: array
                            description: Array of sales framework parameters
                            items:
                              type: object
                              properties:
                                parameter:
                                  type: string
                                  description: Parameter name (e.g., "Metrics")
                                  example: "Metrics"
                                score:
                                  type: number
                                  description: Score for this parameter
                                  example: 0
                                explanation:
                                  type: string
                                  description: Explanation of the score
                                  example: "No business metrics discussed."
                      key_points:
                        type: object
                        properties:
                          key_points:
                            type: array
                            description: Array of key points extracted from the call
                            items:
                              type: object
                              properties:
                                heading:
                                  type: string
                                  description: Heading for the key point
                                  example: "No Key Points"
                                key_point:
                                  type: string
                                  description: Description of the key point
                                  example: "No business-relevant content."
                      metrics:
                        type: object
                        description: Extracted business metrics (varies by call content)
                        additionalProperties: true
                        example: {}
                      questions:
                        type: object
                        properties:
                          buyer_questions:
                            type: array
                            description: Array of questions asked by the buyer
                            items:
                              type: string
                            example: []
                          seller_questions:
                            type: array
                            description: Array of questions asked by the seller
                            items:
                              type: string
                            example: []
              example:
                status: success
                data:
                  call_summary: "Casual conversation with no business-related insights."
                  follow_up_email:
                    email: "Hi Andy,\n\nThanks for the chat. No action items.\n\nRegards,\nAjay"
                  sales_framework:
                    total_score: 0
                    parameters:
                      - parameter: "Metrics"
                        score: 0
                        explanation: "No business metrics discussed."
                  key_points:
                    key_points:
                      - heading: "No Key Points"
                        key_point: "No business-relevant content."
                  metrics: {}
                  questions:
                    buyer_questions: []
                    seller_questions: []
        '400':
          description: Invalid request format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Include your bearer token in the Authorization header:
        ```
        Authorization: Bearer YOUR_TOKEN
        ```

  schemas:
    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
              example: validation_error
            message:
              type: string
              description: Human-readable error message
              example: Invalid request parameters
            details:
              type: object
              description: Additional error details
              additionalProperties:
                type: string
    CallAnalysisRequest:
      type: object
      required:
        - transcript
        - llm_provider
      properties:
        transcript:
          type: array
          description: Array of transcript segments generated from call audio.
          items:
            type: object
            required:
              - speaker
              - speaker_id
              - start_timestamp
              - end_timestamp
              - text
              - is_seller
            properties:
              start_timestamp:
                type: number
                example: 0.18
              end_timestamp:
                type: number
                example: 43.30
              speaker:
                type: string
                example: "Andy Waterhouse"
              speaker_id:
                type: integer
                example: 50332672
              language:
                type: string
                nullable: true
                example: null
              text:
                type: string
                example: "Each other. So we don't get to meet physically..."
              is_seller:
                type: boolean
                example: false
        llm_provider:
          type: string
          description: LLM provider (e.g., "openai")
          example: "openai"
    CallAnalysisResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          type: object
          properties:
            call_summary:
              type: string
              example: Casual conversation with no business-related insights.
            follow_up_email:
              type: object
              properties:
                email:
                  type: string
                  example: |-
                    Hi Andy,

                    Thanks for the chat. No action items.

                    Regards,
                    Ajay
            sales_framework:
              type: object
              properties:
                total_score:
                  type: integer
                  example: 0
                parameters:
                  type: array
                  items:
                    type: object
                    properties:
                      parameter:
                        type: string
                        example: Metrics
                      score:
                        type: integer
                        example: 0
                      explanation:
                        type: string
                        example: No business metrics discussed.
            key_points:
              type: object
              properties:
                key_points:
                  type: array
                  items:
                    type: object
                    properties:
                      heading:
                        type: string
                        example: No Key Points
                      key_point:
                        type: string
                        example: No business-relevant content.
            metrics:
              type: object
              description: Extracted business metrics (varies by call content)
              additionalProperties: true
              example: {}
            questions:
              type: object
              properties:
                buyer_questions:
                  type: array
                  items:
                    type: string
                  example: []
                seller_questions:
                  type: array
                  items:
                    type: string
                  example: []
